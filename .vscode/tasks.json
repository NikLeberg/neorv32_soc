{
    // See https://go.microsoft.com/fwlink/?LinkId=733558
    // for the documentation about the tasks.json format
    "version": "2.0.0",
    "type": "shell",
    "presentation": {
        "clear": true,
        "showReuseMessage": false
    },
    "problemMatcher": [
        {
            // catches compilation warnings and errors
            // # ** Warning: ../vhdl/example.vhdl(30): (vcom-1400) Synthesis Warning: Signal "a" is read in the process but is not in the sensitivity list.
            // # ** Error: ../vhdl/example.vhdl(31): near "END": (vcom-1576) expecting ';'.
            "source": "Sim",
            "owner": "Sim",
            "pattern": [
                {
                    "regexp": "\\*\\* (Error|Warning).*: \\.(.+)\\((\\d+)\\): (.+)$",
                    "file": 2,
                    "line": 3,
                    "message": 4,
                    "severity": 1
                }
            ],
            "fileLocation": "relative"
        },
        {
            // catches failures on design loading
            // # ** Fatal: (vsim-3809) Types do not match between component and entity for generic "VALUE_MAX".
            // #    Time: 0 ns  Iteration: 0  Instance: /offset_tb/dut File: ../vhdl/dds/offset.vhdl Line: 25
            // # FATAL ERROR while loading design
            "source": "Sim",
            "owner": "Sim",
            "pattern": [
                {
                    "regexp": "\\*\\* (?:Failure|Fatal): (.+)$",
                    "message": 1
                },
                {
                    "regexp": "^.+Time:.+File: \\.(.+) Line: (\\d+)$",
                    "file": 1,
                    "line": 2
                }
            ],
            "severity": "error",
            "fileLocation": "relative"
        },
        {
            // catches test failures
            // # ** Failure: 1 AND 0 should equal 0.
            // #    Time: 20 ns  Iteration: 0  Process: /example_tb/test File: ../vhdl/example_tb.vhdl
            // # Break in Process test at ../vhdl/example_tb.vhdl line 54
            // catches fatal errors
            // # ** Fatal: (vsim-3734) Index value 2 is out of range 1 downto 0.
            // #    Time: 0 ns  Iteration: 0  Process: /math_add_tb/test File: ../vhdl/math/tb/math_add_tb.vhdl
            // # Fatal error in ForLoop loop at ../vhdl/math/tb/math_add_tb.vhdl line 69
            "source": "Sim",
            "owner": "Sim",
            "pattern": [
                {
                    "regexp": "\\*\\* (?:Failure|Fatal): (.+)$",
                    "message": 1
                },
                {
                    "regexp": "^.+Time:.+File: \\.(.+)",
                    "file": 1
                },
                {
                    "regexp": "^.+(?:Break|Fatal error) in .* at \\.(.+) line (\\d+)$",
                    "line": 2,
                }
            ],
            "severity": "error",
            "fileLocation": "relative"
        },
        {
            // catches compilation warnings and errors
            // Error (10500): VHDL syntax error at datatypes.vhdl(34) near text "END";  expecting ";" File: datatypes.vhdl Line: 34
            "source": "Quartus",
            "owner": "Quartus",
            "pattern": [
                {
                    "regexp": "(Warning|Error) \\([0-9]+\\): (.+) File: (.+) Line: (.+)$",
                    "severity": 1,
                    "message": 2,
                    "file": 3,
                    "line": 4
                }
            ],
            "fileLocation": "absolute"
        }
    ],
    "tasks": [
        {
            "label": "sim-compile",
            "command": "vsim -c -do ../scripts/sim_compile.tcl",
            "options": {
                "cwd": "${workspaceFolder}/sim"
            }
        },
        {
            "label": "sim-test",
            "command": "vsim -c -do ../scripts/sim_test.tcl",
            "options": {},
            "dependsOn": [
                "sim-compile"
            ]
        },
        {
            "label": "sim-open",
            // Gui Mode (no -c flag)
            "command": "vsim -do ../scripts/sim_open.tcl ${fileBasenameNoExtension}",
            "options": {
                "cwd": "${workspaceFolder}/sim"
            },
            "dependsOn": "sim-compile"
        },
        {
            "label": "quartus-project",
            "command": "quartus_sh -t ../scripts/quartus_project.tcl",
            "options": {
                "cwd": "${workspaceFolder}/quartus"
            }
        },
        {
            "label": "quartus-compile",
            "command": "quartus_sh -t ../scripts/quartus_compile.tcl",
            "options": {
                "cwd": "${workspaceFolder}/quartus"
            },
            "dependsOn": [
                "quartus-project"
            ]
        },
        {
            "label": "quartus-open",
            "command": "quartus_sh -t ../scripts/quartus_open.tcl",
            "options": {
                "cwd": "${workspaceFolder}/quartus"
            },
            "dependsOn": [
                "quartus-project"
            ]
        },
        {
            "label": "quartus-program",
            "command": "quartus_pgm -c USB-Blaster --mode jtag --operation='p;top.sof'",
            "options": {
                "cwd": "${workspaceFolder}/quartus/output_files"
            },
            // "dependsOn": [
            //     "quartus-compile"
            // ]
        },
        {
            "label": "quartus-flash",
            "command": "quartus_cpf -c ../../scripts/quartus_flash.cof; quartus_pgm ../../scripts/quartus_flash.cdf",
            "options": {
                "cwd": "${workspaceFolder}/quartus/output_files",
            },
            "dependsOn": [
                "quartus-compile"
            ]
        },
        {
            "label": "clean",
            "command": "rm -rf quartus/* sim/* && touch quartus/.gitkeep && touch sim/.gitkeep",
            "presentation": {
                "reveal": "silent"
            }
        },
        {
            "label": "sw-build",
            "command": "make exe",
            "options": {
                "cwd": "${workspaceFolder}/sw"
            }
        },
        {
            "label": "sw-clean",
            "command": "make clean_all",
            "options": {
                "cwd": "${workspaceFolder}/sw"
            },
            "presentation": {
                "reveal": "silent"
            }
        },
        {
            "label": "sw-debug",
            "command": "make debug",
            "options": {
                "cwd": "${workspaceFolder}/sw"
            },
            "presentation": {
                "reveal": "silent"
            }
        },
        {
            "label": "sw-env",
            "command": "bash -l",
            "options": {
                "cwd": "${workspaceFolder}/sw"
            }
        }
    ]
}